<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>DOMINUS | Sovereign Core</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Space Grotesk', sans-serif; background-color: #000000; color: #e5e5e5; overflow: hidden; }
        .sync { font-family: 'Syncopate', sans-serif; }
        .terra-text { color: #9c4221; }

        /* Animaciones de Hacking & Vigilancia */
        .scanline {
            width: 100%; height: 2px; background: rgba(220, 38, 38, 0.4);
            position: absolute; z-index: 50; animation: scan 4s linear infinite; pointer-events: none;
            box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
        }
        @keyframes scan { 0% { top: -10%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 110%; opacity: 0; } }

        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* Botón Táctico */
        .tactical-btn:active { transform: scale(0.96); background-color: #7f1d1d; color: white; }

        /* Scroll Oculto */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Glitch Effect sutil */
        .glitch-text:hover {
            text-shadow: 2px 0 #ff0000, -2px 0 #0000ff;
        }
    </style>
</head>
<body class="h-screen flex flex-col justify-between select-none bg-black">

    <!-- FX: Scanline -->
    <div class="scanline"></div>

    <!-- HEADER: ESTADO DEL KERNEL -->
    <div class="bg-black/90 border-b border-red-900/30 p-4 flex justify-between items-end backdrop-blur z-20">
        <div>
            <div class="text-[9px] text-red-600 tracking-[0.3em] mb-1">/// PROTOCOLO ΛMBDA</div>
            <div class="text-xl font-bold text-white flex items-center gap-2">
                <span class="w-2 h-2 bg-red-600 animate-pulse rounded-full"></span> DOMINUS
            </div>
        </div>
        <div class="text-right">
            <div class="text-[9px] text-gray-500 uppercase">Integridad Psíquica</div>
            <div id="entropy-val" class="text-xl font-bold text-red-500 font-mono transition-colors duration-500">100%</div>
        </div>
    </div>

    <!-- VISUALIZADOR CENTRAL (CHART) -->
    <div class="flex-grow relative p-4 flex flex-col justify-center overflow-hidden">
        <!-- Fondo de ruido sutil -->
        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')]"></div>

        <!-- Valor Principal -->
        <div class="text-center z-10 mb-6">
            <div class="text-[10px] text-gray-500 uppercase tracking-widest mb-1">CAPITAL DE VOLUNTAD (TDX)</div>
            <div id="token-display" class="text-6xl md:text-8xl font-bold text-white tracking-tighter sync drop-shadow-[0_0_15px_rgba(220,38,38,0.3)] glitch-text transition-all">
                0.00
            </div>
        </div>

        <!-- Gráfico de Signos Vitales -->
        <div class="h-40 w-full border-l border-b border-gray-800 relative z-10">
            <canvas id="mobileChart"></canvas>
        </div>

        <!-- Terminal de Revelación (Payload Memético) -->
        <div id="console-log" class="mt-8 h-28 overflow-hidden text-[11px] font-mono text-green-500/90 p-3 border border-gray-800 bg-black/80 leading-relaxed shadow-inner">
            <span class="text-red-500">root@dmz:~#</span> INICIANDO SECUENCIA...<br>
            <span class="text-gray-500">> Esperando input del operador...</span>
        </div>
    </div>

    <!-- CONTROLES TÁCTICOS (FOOTER) -->
    <div class="bg-[#050505] p-6 border-t border-gray-900 z-20 pb-12 shadow-[0_-10px_40px_rgba(0,0,0,1)]">
        <div class="grid grid-cols-2 gap-4 mb-5">
            <div class="text-center group">
                <div class="text-[9px] text-gray-600 uppercase group-hover:text-red-500 transition-colors">Sincronización</div>
                <div id="system-clock" class="text-xs text-gray-400 font-mono">EN ESPERA</div>
            </div>
            <div class="text-center group">
                <div class="text-[9px] text-gray-600 uppercase group-hover:text-red-500 transition-colors">Nivel de Acceso</div>
                <div id="access-level" class="text-xs text-terra-text font-bold">NVL. 0</div>
            </div>
        </div>

        <button id="inject-btn" class="tactical-btn w-full bg-white text-black font-bold h-16 text-sm uppercase tracking-[0.2em] transition-all flex items-center justify-center gap-3 relative overflow-hidden group shadow-[0_0_15px_rgba(255,255,255,0.1)] hover:shadow-[0_0_20px_rgba(255,255,255,0.3)]">
            <div class="absolute inset-0 bg-red-600 w-0 group-hover:w-full transition-all duration-300 opacity-20"></div>
            <span class="z-10 font-sync">ASIMILAR REALIDAD</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 z-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
        </button>

        <div class="text-[8px] text-center text-gray-800 mt-4 font-mono opacity-50">
            DAEMON::SOBERANO::V2 // STORAGE LOCAL // SIN NUBE
        </div>
    </div>

<script>
    // --- 0. CONFIGURACIÓN SOBERANA (TEORÍA DEL COLOR & THORNE) ---
    // Mapeo basado en tu gráfico de color
    const CHROMATIC_SOUL = {
        CHAOS:  { color: '#ff0000', label: 'INTENSIDAD / SANGRE' }, // Rojo
        ORDER:  { color: '#0000ff', label: 'ESTABILIDAD / PROFUNDIDAD' }, // Azul
        SOVEREIGN: { color: '#800080', label: 'PODER / REALEZA' } // Púrpura
    };

    // Swing de J Dilla (Milisegundos de retraso intencional)
    const JDILLA_SWING = { KICK: -2, SNARE: 7 };

    // --- 1. EL CEREBRO LOCAL (Persistencia) ---
    const STORAGE_KEY = 'DOMINUS_CORE_V2'; // Versión Actualizada
    let SYSTEM_STATE = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
        value: 10.00,
        entropy: 70, // Inicia en caos
        history: Array(20).fill(10)
    };

    // --- 2. SISTEMA DE AUDIO (EL LATIDO OCULTO) ---
    // Secreto: Usamos AudioContext para generar frecuencias binaurales sutiles
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const audioEngine = new AudioCtx();

    function playThorneTone(type) {
        if (audioEngine.state === 'suspended') audioEngine.resume();
        const osc = audioEngine.createOscillator();
        const gain = audioEngine.createGain();

        // Frecuencia basada en la Entropía: Más caos = Más agudo/disonante
        const freq = type === 'KICK' ? 60 : (100 + SYSTEM_STATE.entropy);

        osc.frequency.setValueAtTime(freq, audioEngine.currentTime);
        // Swing: Aplicamos el retraso temporal aquí
        const delay = (type === 'KICK' ? JDILLA_SWING.KICK : JDILLA_SWING.SNARE) / 1000;

        osc.connect(gain);
        gain.connect(audioEngine.destination);

        osc.start(audioEngine.currentTime + Math.max(0, delay));
        gain.gain.exponentialRampToValueAtTime(0.001, audioEngine.currentTime + 0.1 + Math.max(0, delay));
        osc.stop(audioEngine.currentTime + 0.2);
    }

    // --- 3. VISUALIZACIÓN VIVA (Chart.js + Color) ---
    const ctx = document.getElementById('mobileChart').getContext('2d');

    // Gradiente dinámico (Sangre Cromática)
    let gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(156, 66, 33, 0.5)');
    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array(20).fill(''),
            datasets: [{
                label: 'Pulso VNM',
                data: SYSTEM_STATE.history,
                borderColor: '#9c4221',
                backgroundColor: gradient,
                borderWidth: 2,
                tension: 0.4, // Curva orgánica, no escalones rígidos
                pointRadius: 0, // Puntos invisibles para fluidez
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false, min: 0 } },
            animation: { duration: 800, easing: 'easeOutElastic' } // Rebote orgánico
        }
    });

    // --- 4. LÓGICA DE ACTUALIZACIÓN & COLOR ---
    function updateReality() {
        // A. Actualizar Textos
        document.getElementById('token-display').innerText = SYSTEM_STATE.value.toFixed(2);
        document.getElementById('entropy-val').innerText = SYSTEM_STATE.entropy + "%";

        // B. Mutación Cromática (El Secreto Visual)
        const body = document.body;
        const nav = document.querySelector('nav');

        if (SYSTEM_STATE.entropy > 50) {
            // Estado Caos (Rojo/Naranja)
            body.style.backgroundColor = "#050000";
            document.documentElement.style.setProperty('--main-color', CHROMATIC_SOUL.CHAOS.color);
        } else if (SYSTEM_STATE.value > 100) {
            // Estado Soberano (Púrpura)
            body.style.backgroundColor = "#0a000a";
            document.documentElement.style.setProperty('--main-color', CHROMATIC_SOUL.SOVEREIGN.color);
        } else {
            // Estado Orden (Azul/Negro)
            body.style.backgroundColor = "#000005";
            document.documentElement.style.setProperty('--main-color', CHROMATIC_SOUL.ORDER.color);
        }

        // C. Guardar
        localStorage.setItem(STORAGE_KEY, JSON.stringify(SYSTEM_STATE));
    }

    // --- 5. EL RITUAL DE INYECCIÓN ---
    const btn = document.getElementById('inject-btn');
    const consoleLog = document.getElementById('console-log');

    btn.addEventListener('click', function() {
        // 1. Feedback Háptico + Sonoro (El Latido)
        if (navigator.vibrate) navigator.vibrate([50, 30, 50]); // Patrón cardíaco
        playThorneTone('KICK');

        // 2. Procesamiento Visual
        btn.innerHTML = "SINTONIZANDO FRECUENCIA...";
        btn.classList.add('opacity-50');

        log(">>> INICIANDO PROTOCOLO ALMA...");

        setTimeout(() => {
            // 3. Modificación de Variables de Realidad
            // Si la entropía es alta, el valor crece lento. Si es baja, crece rápido.
            const growthFactor = (100 - SYSTEM_STATE.entropy) / 10;
            SYSTEM_STATE.value += Math.max(1, growthFactor);
            SYSTEM_STATE.entropy = Math.max(0, SYSTEM_STATE.entropy - Math.floor(Math.random() * 15));

            // Mantener historial (FIFO)
            SYSTEM_STATE.history.shift();
            SYSTEM_STATE.history.push(SYSTEM_STATE.value);

            // 4. Actualizar Sistema
            chart.data.datasets[0].data = SYSTEM_STATE.history;
            chart.update();
            updateReality();

            playThorneTone('SNARE'); // Respuesta sonora

            log(`>>> SINCRONIZACIÓN COMPLETADA. VNM: ${SYSTEM_STATE.value.toFixed(2)}`);
            log(`>>> ESTADO CROMÁTICO: ${SYSTEM_STATE.entropy > 50 ? 'INICIE PURGA (ROJO)' : 'ESTABLE (AZUL)'}`);

            // Restaurar Botón
            btn.innerHTML = `<span>EJECUTAR PROTOCOLO</span><span class="text-terra-text font-mono">>>></span>`;
            btn.classList.remove('opacity-50');

        }, 880); // 880ms (Referencia a 88 BPM)
    });

    function log(msg) {
        const line = document.createElement('div');
        // SECURITY: Use textContent instead of innerHTML to prevent DOM-based XSS.
        line.textContent = `> ${msg}`;
        line.style.color = getComputedStyle(document.documentElement).getPropertyValue('--main-color');
        consoleLog.prepend(line);
    }

    function hardReset() {
        if(confirm("¿COLAPSO TOTAL DE ONDA? Esto borrará tu línea temporal.")) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }

    // Reloj
    setInterval(() => {
        const now = new Date();
        document.getElementById('system-clock').innerText =
            `T-${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
    }, 1000);

    // Inicializar
    updateReality();

</script>
</body>
</html>
