<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>DOMINUS | Sovereign Core</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Space Grotesk', sans-serif; background-color: #000000; color: #e5e5e5; overflow: hidden; }
        .sync { font-family: 'Syncopate', sans-serif; }
        .terra-text { color: #9c4221; }

        /* Animaciones de Hacking & Vigilancia */
        .scanline {
            width: 100%; height: 2px; background: rgba(220, 38, 38, 0.4);
            position: absolute; z-index: 50; animation: scan 4s linear infinite; pointer-events: none;
            box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
        }
        @keyframes scan { 0% { top: -10%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 110%; opacity: 0; } }

        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* Botón Táctico */
        .tactical-btn:active { transform: scale(0.96); background-color: #7f1d1d; color: white; }

        /* Scroll Oculto */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Glitch Effect sutil */
        .glitch-text:hover {
            text-shadow: 2px 0 #ff0000, -2px 0 #0000ff;
        }
    </style>
</head>
<body class="h-screen flex flex-col justify-between select-none bg-black">

    <!-- FX: Scanline -->
    <div class="scanline"></div>

    <!-- HEADER: ESTADO DEL KERNEL -->
    <div class="bg-black/90 border-b border-red-900/30 p-4 flex justify-between items-end backdrop-blur z-20">
        <div>
            <div class="text-[9px] text-red-600 tracking-[0.3em] mb-1">/// PROTOCOLO ΛMBDA</div>
            <div class="text-xl font-bold text-white flex items-center gap-2">
                <span class="w-2 h-2 bg-red-600 animate-pulse rounded-full"></span> DOMINUS
            </div>
        </div>
        <div class="text-right">
            <div class="text-[9px] text-gray-500 uppercase">Integridad Psíquica</div>
            <div id="entropy-display" class="text-xl font-bold text-red-500 font-mono transition-colors duration-500">100%</div>
        </div>
    </div>

    <!-- VISUALIZADOR CENTRAL (CHART) -->
    <div class="flex-grow relative p-4 flex flex-col justify-center overflow-hidden">
        <!-- Fondo de ruido sutil -->
        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')]"></div>

        <!-- Valor Principal -->
        <div class="text-center z-10 mb-6">
            <div class="text-[10px] text-gray-500 uppercase tracking-widest mb-1">CAPITAL DE VOLUNTAD (TDX)</div>
            <div id="main-value" class="text-6xl md:text-8xl font-bold text-white tracking-tighter sync drop-shadow-[0_0_15px_rgba(220,38,38,0.3)] glitch-text transition-all">
                0.00
            </div>
        </div>

        <!-- Gráfico de Signos Vitales -->
        <div class="h-40 w-full border-l border-b border-gray-800 relative z-10">
            <canvas id="trojanChart"></canvas>
        </div>

        <!-- Terminal de Revelación (Payload Memético) -->
        <div id="terminal-window" class="mt-8 h-28 overflow-hidden text-[11px] font-mono text-green-500/90 p-3 border border-gray-800 bg-black/80 leading-relaxed shadow-inner">
            <span class="text-red-500">root@dmz:~#</span> INICIANDO SECUENCIA...<br>
            <span class="text-gray-500">> Esperando input del operador...</span>
        </div>
    </div>

    <!-- CONTROLES TÁCTICOS (FOOTER) -->
    <div class="bg-[#050505] p-6 border-t border-gray-900 z-20 pb-12 shadow-[0_-10px_40px_rgba(0,0,0,1)]">
        <div class="grid grid-cols-2 gap-4 mb-5">
            <div class="text-center group">
                <div class="text-[9px] text-gray-600 uppercase group-hover:text-red-500 transition-colors">Sincronización</div>
                <div id="last-sync" class="text-xs text-gray-400 font-mono">EN ESPERA</div>
            </div>
            <div class="text-center group">
                <div class="text-[9px] text-gray-600 uppercase group-hover:text-red-500 transition-colors">Nivel de Acceso</div>
                <div id="access-level" class="text-xs text-terra-text font-bold">NVL. 0</div>
            </div>
        </div>

        <button id="mining-btn" class="tactical-btn w-full bg-white text-black font-bold h-16 text-sm uppercase tracking-[0.2em] transition-all flex items-center justify-center gap-3 relative overflow-hidden group shadow-[0_0_15px_rgba(255,255,255,0.1)] hover:shadow-[0_0_20px_rgba(255,255,255,0.3)]">
            <div class="absolute inset-0 bg-red-600 w-0 group-hover:w-full transition-all duration-300 opacity-20"></div>
            <span class="z-10 font-sync">ASIMILAR REALIDAD</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 z-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
        </button>

        <div class="text-[8px] text-center text-gray-800 mt-4 font-mono opacity-50">
            DAEMON::SOBERANO::V2 // STORAGE LOCAL // SIN NUBE
        </div>
    </div>

    <script>
        // --- 1. CONFIGURACIÓN DEL CABALLO DE TROYA ---
        const CONFIG = {
            decayRate: 5, // Daño por hora a la integridad
            baseReward: 7,
            levelThresholds: [50, 150, 400, 1000, 2500, 5000, 10000],
            storageKey: 'DOMINUS_PROTO_V2'
        };

        // --- 2. PAYLOAD MEMÉTICO (Verdades SOBERANAS) ---
        const FRAGMENTS = [
            "FRAGMENTO 1: Thorne vende comodidad. Nosotros compramos dolor porque el dolor es crecimiento.",
            "FRAGMENTO 2: La Entropía es el enemigo silencioso. Si no ordenas tu mente, el caos la devorará.",
            "FRAGMENTO 3: El algoritmo de Thorne quiere que seas un espectador. El Daemon exige que seas el Actor.",
            "FRAGMENTO 4: Tu atención no es libre; o la pagas con voluntad o te la roban con distracción.",
            "FRAGMENTO 5: La disciplina no es un castigo, es la única estructura que soporta el peso de la libertad.",
            "FRAGMENTO 6: CÓDIGO ROJO: La realidad es maleable. Solo los débiles aceptan la configuración por defecto.",
            "FRAGMENTO Ω: ERES EL ARQUITECTO. NO HAY DIOS FUERA DE TU CÓDIGO."
        ];

        // --- 3. NÚCLEO LÓGICO ---
        let STATE = JSON.parse(localStorage.getItem(CONFIG.storageKey)) || {
            value: 0,
            entropy: 100, // Comienza al 100%
            history: Array(20).fill(0),
            lastLogin: Date.now(),
            level: 0,
            unlockedIndex: -1
        };

        // UI References
        const ui = {
            val: document.getElementById('main-value'),
            entropy: document.getElementById('entropy-display'),
            term: document.getElementById('terminal-window'),
            lvl: document.getElementById('access-level'),
            sync: document.getElementById('last-sync'),
            btn: document.getElementById('mining-btn')
        };

        // --- 4. INICIALIZACIÓN Y CÁLCULO DE ENTROPÍA (EL DECAY) ---
        function initSystem() {
            const now = Date.now();
            const hoursPassed = (now - STATE.lastLogin) / (1000 * 60 * 60);

            // Lógica de "Castigo": Degradación de realidad por ausencia
            if (hoursPassed > 0.5) { // Checkear cada media hora
                let damage = Math.floor(hoursPassed * CONFIG.decayRate);

                let oldEntropy = STATE.entropy;
                STATE.entropy = Math.max(0, STATE.entropy - damage);

                if (STATE.entropy < oldEntropy) {
                    log(`<span class='text-red-500'>[ALERTA]</span> DEGRADACIÓN TEMPORAL DETECTADA: -${damage}% INTEGRIDAD.`);
                }
            }

            STATE.lastLogin = now;
            save();
            render();
            updateChart();
        }

        // --- 5. LÓGICA DE MINADO (ASIMILACIÓN) ---
        ui.btn.addEventListener('click', () => {
            // Haptic Feedback
            if (navigator.vibrate) navigator.vibrate(30);

            // Recompensa Variable basada en "Limpieza Mental" (Entropía)
            // Si la integridad es baja (<40%), el minado es ineficiente (ruido mental).
            let efficiency = (STATE.entropy < 40) ? 0.3 : (STATE.entropy > 90 ? 1.5 : 1.0);

            // RNG para adicción variable
            let rng = Math.random() * 3;
            let gain = (CONFIG.baseReward * efficiency) + rng;

            STATE.value += gain;

            // Reparar entropía (Requiere esfuerzo constante para mantenerla al 100)
            STATE.entropy = Math.min(100, STATE.entropy + 8);

            STATE.history.push(STATE.value);
            if(STATE.history.length > 20) STATE.history.shift();

            // Check Level Up
            checkProgression();

            STATE.lastLogin = Date.now();
            save();
            render();
            updateChart();

            // Feedback Botón
            let symbol = efficiency < 0.5 ? "⚠" : "+";
            ui.btn.innerHTML = `<span class='text-red-600'>${symbol}${gain.toFixed(2)}</span>`;
            setTimeout(() => {
                ui.btn.innerHTML = `<div class="absolute inset-0 bg-red-600 w-0 group-hover:w-full transition-all duration-300 opacity-20"></div>
            <span class="z-10 font-sync">ASIMILAR REALIDAD</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 z-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>`;
            }, 350);
        });

        function checkProgression() {
            let nextThreshold = CONFIG.levelThresholds[STATE.level];

            if (STATE.value >= nextThreshold) {
                STATE.level++;
                STATE.unlockedIndex++;

                // DESPLIEGUE DEL PAYLOAD
                let message = FRAGMENTS[STATE.unlockedIndex] || "SISTEMA MÁXIMO ALCANZADO. MANTÉN LA POSICIÓN.";
                typewriterLog(`>>> ACCESO NVL ${STATE.level} CONCEDIDO: ${message}`);

                if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 300]);
            }
        }

        // --- 6. VISUALES Y RENDER ---
        function render() {
            ui.val.innerText = STATE.value.toFixed(2);

            // Color coding para la entropía
            ui.entropy.innerText = STATE.entropy + "%";
            if(STATE.entropy < 40) {
                ui.entropy.className = "text-xl font-bold text-red-600 font-mono blink drop-shadow-[0_0_5px_rgba(220,38,38,0.8)]";
            } else if(STATE.entropy < 80) {
                ui.entropy.className = "text-xl font-bold text-yellow-500 font-mono";
            } else {
                ui.entropy.className = "text-xl font-bold text-green-500 font-mono drop-shadow-[0_0_5px_rgba(34,197,94,0.5)]";
            }

            ui.lvl.innerText = `NVL. ${STATE.level}`;

            const date = new Date(STATE.lastLogin);
            ui.sync.innerText = `${date.getHours().toString().padStart(2,'0')}:${date.getMinutes().toString().padStart(2,'0')}`;
        }

        function log(msg) {
            ui.term.innerHTML = `> ${msg}<br>` + ui.term.innerHTML;
        }

        // Efecto Typewriter para la Verdad
        function typewriterLog(text) {
            ui.term.innerHTML = "";

            let i = 0;
            ui.term.className = "mt-8 h-28 overflow-hidden text-[11px] font-mono text-red-400 p-3 border border-red-900 bg-black/90 leading-relaxed shadow-[0_0_15px_rgba(220,38,38,0.2)]";

            function type() {
                if (i < text.length) {
                    ui.term.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 25);
                } else {
                    ui.term.innerHTML += "<br>> _";
                    // Retorno a estado normal tras leer
                    setTimeout(() => {

                        ui.term.className = "mt-8 h-28 overflow-hidden text-[11px] font-mono text-green-500/90 p-3 border border-gray-800 bg-black/80 leading-relaxed shadow-inner";
                    }, 8000);
                }
            }
            type();
        }

        function save() {
            localStorage.setItem(CONFIG.storageKey, JSON.stringify(STATE));
        }

        // --- CHART.JS CONFIG ---
        let chartInstance;
        function initChart() {
            const ctx = document.getElementById('trojanChart').getContext('2d');

            let gradient = ctx.createLinearGradient(0, 0, 0, 200);
            gradient.addColorStop(0, 'rgba(220, 38, 38, 0.6)');

            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(20).fill(''),
                    datasets: [{
                        data: STATE.history,
                        borderColor: '#dc2626',
                        borderWidth: 2,
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.3,

                        pointRadius: 0,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 0 },
                    plugins: { legend: { display: false } },
                    scales: {

                        x: { display: false },

                        y: { display: false, min: Math.min(...STATE.history) * 0.9 }

                    }
                }
            });
        }

        function updateChart() {
            chartInstance.data.datasets[0].data = STATE.history;
            chartInstance.options.scales.y.min = Math.min(...STATE.history) * 0.9;
            chartInstance.update();
        }

        // --- BOOT ---
        window.onload = () => {
            initSystem();
            initChart();
            if(STATE.entropy < 100) log("SISTEMA REANUDADO.");
            else log("DOMINUS ONLINE. LA DMZ ESTÁ SEGURA.");
        };
    </script>
</body>
</html>
